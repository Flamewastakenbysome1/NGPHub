<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>File Converter ‚Äî NGP Hub</title>

<meta property="og:title" content="NGP Hub ‚Äî File Converter" />
<meta property="og:description" content="Convert between tons of file formats. All processing happens in your browser." />
<meta property="og:image" content="https://ngphub.com/assets/ngp-logo.png" />
<meta property="og:url" content="https://ngphub.com/converter" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="NGP Hub" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="NGP Hub ‚Äî File Converter" />
<meta name="twitter:description" content="Convert between tons of file formats." />
<meta name="twitter:image" content="https://ngphub.com/assets/ngp-logo.png" />

<meta name="description" content="Convert between tons of file formats. All processing happens in your browser." />
<meta name="keywords" content="file converter, format converter, NGP tools" />

<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet" />
<link rel="icon" href="/assets/ngp-logo.png" type="image/png">

<style>
  :root{
    --bg:#0e0e11; --card:#15151b; --ink:#ececf1; --muted:#b5b7c3;
    --brandA:#6a11cb; --brandB:#2575fc; --line:#3a66ff;
    --ring:0 0 0 .2rem rgba(37,117,252,.35);
    --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#0b0b0e,#121219 60%,#0d0d14);
    color:var(--ink);
    font-family:'Rubik',system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    scroll-behavior:smooth;
  }
  .wrap{max-width:1024px; margin:0 auto; padding:0 16px}

  header{
    position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(10px);
    background:rgba(10,10,14,.6); border-bottom:1px solid rgba(255,255,255,.06);
  }
  .bar{display:flex; align-items:center; justify-content:space-between; padding:12px 0}
  .logo{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--ink)}
  .logo-img{width:28px; height:28px; border-radius:10px; object-fit:contain; box-shadow:var(--shadow)}
  .logo h1{font-size:1.05rem; margin:0; letter-spacing:.3px}
  nav{display:flex; align-items:center; gap:6px; flex-wrap:wrap}
  nav a{
    color:var(--ink); text-decoration:none; font-weight:500; margin-left:0;
    padding:8px 10px; border-radius:10px; opacity:.9
  }
  nav a:hover, nav a:focus-visible{background:rgba(255,255,255,.06); outline:none; box-shadow:var(--ring)}

  .modal{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.8); backdrop-filter:blur(5px); z-index:1000; align-items:center; justify-content:center}
  .modal.active{display:flex}
  .modal-content{background:var(--card); border-radius:var(--radius); max-width:450px; width:90%; box-shadow:0 20px 60px rgba(0,0,0,.5); border:1px solid rgba(255,255,255,.1); animation:modalSlideIn 0.3s ease-out}
  @keyframes modalSlideIn{from{transform:translateY(-50px); opacity:0} to{transform:translateY(0); opacity:1}}
  .modal-header{padding:20px 24px; border-bottom:1px solid rgba(255,255,255,.06)}
  .modal-header h3{margin:0; font-size:1.2rem}
  .modal-body{padding:24px; line-height:1.6}
  .modal-body p{margin:0}
  .modal-footer{padding:16px 24px; border-top:1px solid rgba(255,255,255,.06); display:flex; gap:12px; justify-content:flex-end}
  .btn{display:inline-block; text-decoration:none; color:white; font-weight:700; letter-spacing:.2px; padding:10px 14px; border-radius:12px; background:linear-gradient(120deg,var(--brandA),var(--brandB)); border:none; cursor:pointer; font-size:.95rem}
  .btn-ghost{background:rgba(255,255,255,.05); color:var(--ink); border:1px solid rgba(255,255,255,.1); padding:10px 20px; border-radius:10px; font-weight:600; cursor:pointer; font-size:.95rem}

  footer{border-top:1px solid rgba(255,255,255,.08); color:var(--muted); padding:24px 0 36px; text-align:center}

  main{padding:60px 0 80px; min-height:calc(100vh - 200px)}
  .hero{text-align:center; margin-bottom:48px}
  .hero h2{font-size:2.5rem; margin:0 0 12px; background:linear-gradient(120deg,var(--brandA),var(--brandB)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text}
  .hero p{color:var(--muted); font-size:1.1rem; margin:0}

  .card{background:var(--card); border-radius:var(--radius); padding:32px; border:1px solid rgba(255,255,255,.06); box-shadow:var(--shadow)}
  
  .upload-zone{
    border:2px dashed rgba(255,255,255,.15); border-radius:var(--radius); padding:48px 24px;
    text-align:center; cursor:pointer; transition:all .3s; margin-bottom:24px
  }
  .upload-zone:hover{border-color:var(--brandB); background:rgba(37,117,252,.05)}
  .upload-zone.drag-over{border-color:var(--brandA); background:rgba(106,17,203,.1)}
  .upload-icon{font-size:3rem; margin-bottom:12px; opacity:.6}
  .upload-text{font-size:1.1rem; color:var(--muted); margin-bottom:8px}
  .upload-hint{font-size:.9rem; color:var(--muted); opacity:.7}

  .file-input{display:none}

  .file-info{
    background:rgba(255,255,255,.03); border-radius:10px; padding:16px; margin-bottom:16px;
    border:1px solid rgba(255,255,255,.06); display:none
  }
  .file-info-item{display:flex; justify-content:space-between; margin-bottom:8px}
  .file-info-item:last-child{margin-bottom:0}
  .file-info-label{color:var(--muted); font-size:.9rem}
  .file-info-value{color:var(--ink); font-weight:600}

  .preview-section{
    background:rgba(255,255,255,.02); border-radius:var(--radius); padding:24px;
    border:1px solid rgba(255,255,255,.06); margin-bottom:24px; display:none
  }
  .preview-header{margin-bottom:16px}
  .preview-header h3{margin:0 0 4px; font-size:1.1rem; color:var(--ink)}
  .preview-header p{margin:0; font-size:.85rem; color:var(--muted)}
  .preview-container{
    background:rgba(0,0,0,.3); border-radius:12px; padding:20px;
    display:flex; align-items:center; justify-content:center;
    min-height:300px; margin-bottom:24px; overflow:auto
  }
  #preview-canvas{
    max-width:100%; max-height:500px; border-radius:8px;
    box-shadow:0 4px 20px rgba(0,0,0,.3); display:block
  }

  .editor-controls{
    background:rgba(255,255,255,.03); border-radius:10px; padding:20px;
    border:1px solid rgba(255,255,255,.06); display:none
  }
  .editor-controls.active{display:block}
  .control-group{
    display:flex; align-items:center; gap:12px; margin-bottom:16px;
    flex-wrap:wrap
  }
  .control-group:last-child{margin-bottom:0}
  .control-group label{
    color:var(--muted); font-weight:600; min-width:120px; font-size:.9rem
  }
  .control-group input[type="range"]{
    flex:1; min-width:200px; height:6px; border-radius:3px;
    background:rgba(255,255,255,.1); outline:none;
    -webkit-appearance:none; appearance:none
  }
  .control-group input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:16px; height:16px;
    border-radius:50%; background:linear-gradient(120deg,var(--brandA),var(--brandB));
    cursor:pointer; box-shadow:0 2px 8px rgba(37,117,252,.4)
  }
  .control-group input[type="range"]::-moz-range-thumb{
    width:16px; height:16px; border-radius:50%;
    background:linear-gradient(120deg,var(--brandA),var(--brandB));
    cursor:pointer; border:none; box-shadow:0 2px 8px rgba(37,117,252,.4)
  }
  .control-group span{
    color:var(--ink); font-weight:600; min-width:60px; text-align:right;
    font-size:.9rem
  }
  .reset-btn{
    margin-top:8px; padding:10px 20px; border-radius:10px;
    background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1);
    color:var(--ink); font-weight:600; cursor:pointer; font-size:.9rem;
    transition:all .2s
  }
  .reset-btn:hover{
    background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.15)
  }

  .format-select{display:flex; gap:12px; margin-bottom:24px; align-items:center; flex-wrap:wrap; display:none}
  .format-select label{color:var(--muted); font-weight:600}
  .format-select select{
    background:var(--card); border:1px solid rgba(255,255,255,.15);
    color:var(--ink); padding:10px 16px; border-radius:10px; font-size:.95rem;
    cursor:pointer; flex:1; min-width:200px
  }
  .format-select select:focus{outline:none; box-shadow:var(--ring)}
  .format-select select option{
    background:var(--card); color:var(--ink); padding:8px
  }

  .convert-btn{
    width:100%; padding:14px; border-radius:12px; background:linear-gradient(120deg,var(--brandA),var(--brandB));
    color:white; font-weight:700; font-size:1.05rem; border:none; cursor:pointer;
    transition:transform .2s, box-shadow .2s; margin-bottom:24px
  }
  .convert-btn:hover:not(:disabled){transform:translateY(-2px); box-shadow:0 8px 20px rgba(37,117,252,.4)}
  .convert-btn:disabled{opacity:.5; cursor:not-allowed; transform:none}

  .progress-bar{
    height:8px; background:rgba(255,255,255,.1); border-radius:4px; overflow:hidden;
    margin-bottom:16px; display:none
  }
  .progress-fill{
    height:100%; background:linear-gradient(90deg,var(--brandA),var(--brandB));
    width:0%; transition:width .3s
  }

  .status{
    text-align:center; padding:16px; border-radius:10px; margin-bottom:16px;
    display:none; font-weight:600
  }
  .status.info{background:rgba(37,117,252,.15); color:#5eb3ff; border:1px solid rgba(37,117,252,.3)}
  .status.success{background:rgba(40,199,111,.15); color:#5fffb0; border:1px solid rgba(40,199,111,.3)}
  .status.error{background:rgba(235,87,87,.15); color:#ff6b6b; border:1px solid rgba(235,87,87,.3)}

  .download-btn{
    width:100%; padding:14px; border-radius:12px; background:rgba(40,199,111,.2);
    border:1px solid rgba(40,199,111,.4); color:#5fffb0; font-weight:700;
    cursor:pointer; display:none; font-size:1.05rem
  }
  .download-btn:hover{background:rgba(40,199,111,.3)}

  @media (max-width: 768px) {
    .hero h2{font-size:2rem}
    .control-group{flex-direction:column; align-items:flex-start}
    .control-group label{min-width:auto}
    .control-group input[type="range"]{width:100%; min-width:auto}
    .control-group span{min-width:auto}
  }

  @media (prefers-reduced-motion: reduce){*{transition:none !important; animation:none !important}}
</style>
</head>
<body>

<header>
  <div class="wrap bar">
    <a class="logo" href="/">
      <img src="/assets/ngp-logo.png" alt="NGP Logo" class="logo-img" />
      <h1>NGP</h1>
    </a>
    <nav aria-label="Primary">
      <a href="/tools">Tools</a>
      <a href="/discordservers/">Servers</a>
      <a href="/projects">Projects</a>
      <a href="/docs/">Docs</a>
      <a href="/roblox">Roblox</a>
      <a href="/contact">Contact</a>
      <a href="/login" id="auth-link">Login</a>
    </nav>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="hero">
      <h2>File Converter</h2>
      <p>Convert between tons of formats ‚Äî all in your browser</p>
    </div>

    <div class="card">
      <div class="upload-zone" id="upload-zone">
        <div class="upload-icon">üì§</div>
        <div class="upload-text">Drop a file here or click to browse</div>
        <div class="upload-hint">Supports images, videos, audio, documents, and more</div>
        <input type="file" id="file-input" class="file-input" />
      </div>

      <div class="file-info" id="file-info">
        <div class="file-info-item">
          <span class="file-info-label">File Name:</span>
          <span class="file-info-value" id="file-name">-</span>
        </div>
        <div class="file-info-item">
          <span class="file-info-label">File Type:</span>
          <span class="file-info-value" id="file-type">-</span>
        </div>
        <div class="file-info-item">
          <span class="file-info-label">File Size:</span>
          <span class="file-info-value" id="file-size">-</span>
        </div>
      </div>

      <div class="format-select" id="format-select-container">
        <label>Convert to:</label>
        <select id="output-format">
          <option value="">Select format...</option>
        </select>
      </div>

      <div class="preview-section" id="preview-section">
        <div class="preview-header">
          <h3>Output Preview</h3>
          <p>Preview of what your converted file will look like</p>
        </div>
        <div class="preview-container">
          <canvas id="preview-canvas"></canvas>
        </div>
        
        <!-- Image/GIF Editor Controls -->
        <div class="editor-controls" id="editor-controls">
          <div class="control-group">
            <label>Brightness</label>
            <input type="range" id="brightness" min="0" max="200" value="100" />
            <span id="brightness-val">100%</span>
          </div>
          <div class="control-group">
            <label>Contrast</label>
            <input type="range" id="contrast" min="0" max="200" value="100" />
            <span id="contrast-val">100%</span>
          </div>
          <div class="control-group">
            <label>Saturation</label>
            <input type="range" id="saturation" min="0" max="200" value="100" />
            <span id="saturation-val">100%</span>
          </div>
          <div class="control-group">
            <label>Blur</label>
            <input type="range" id="blur" min="0" max="20" value="0" />
            <span id="blur-val">0px</span>
          </div>
          <div class="control-group">
            <label>Rotation</label>
            <input type="range" id="rotation" min="0" max="360" value="0" step="15" />
            <span id="rotation-val">0¬∞</span>
          </div>
          
          <!-- GIF Specific Controls -->
          <div id="gif-controls" style="display:none">
            <div class="control-group">
              <label>Color Palette</label>
              <input type="range" id="gif-colors" min="8" max="256" value="256" step="8" />
              <span id="gif-colors-val">256</span>
            </div>
          </div>
          
          <button class="reset-btn" id="reset-filters">Reset All</button>
        </div>
      </div>

      <div class="progress-bar" id="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>

      <div class="status" id="status"></div>

      <button class="convert-btn" id="convert-btn" disabled>Select a file to convert</button>
      <button class="download-btn" id="download-btn">Download Converted File</button>
    </div>
  </div>
</main>

<footer>
  <div class="wrap">
    <small>¬© <span id="year"></span> NGP ‚Äî Alpha.</small>
  </div>
</footer>

<div id="logout-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Logout from NGP Hub?</h3>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to logout?</p>
    </div>
    <div class="modal-footer">
      <button class="btn-ghost" id="cancel-logout-btn">Cancel</button>
      <button class="btn" id="confirm-logout-btn">Logout</button>
    </div>
  </div>
</div>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();
</script>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

  const firebaseConfig = {
    apiKey: "AIzaSyASMd5kEAscaERvWAT6rYmZSahP2NFW0E0",
    authDomain: "ngp-hub.firebaseapp.com",
    projectId: "ngp-hub",
    storageBucket: "ngp-hub.firebasestorage.app",
    messagingSenderId: "157947384705",
    appId: "1:157947384705:web:c89e95d6d9f7436bb5ce80"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const authLink = document.getElementById('auth-link');
  const logoutModal = document.getElementById('logout-modal');
  const confirmLogoutBtn = document.getElementById('confirm-logout-btn');
  const cancelLogoutBtn = document.getElementById('cancel-logout-btn');

  onAuthStateChanged(auth, (user) => {
    if (user) {
      authLink.textContent = user.email.split('@')[0];
      authLink.href = '#';
      authLink.addEventListener('click', (e) => {
        e.preventDefault();
        logoutModal.classList.add('active');
      });
    } else {
      authLink.textContent = 'Login';
      authLink.href = '/login';
    }
  });

  cancelLogoutBtn.addEventListener('click', () => {
    logoutModal.classList.remove('active');
  });

  confirmLogoutBtn.addEventListener('click', async () => {
    await signOut(auth);
    window.location.reload();
  });
</script>

<script>
  // Conversion format mappings
  const formatMap = {
    // Images
    'png': ['jpg', 'jpeg', 'webp', 'gif', 'bmp', 'ico', 'svg', 'tiff', 'avif'],
    'jpg': ['png', 'webp', 'gif', 'bmp', 'ico', 'svg', 'tiff', 'avif'],
    'jpeg': ['png', 'webp', 'gif', 'bmp', 'ico', 'svg', 'tiff', 'avif'],
    'webp': ['png', 'jpg', 'jpeg', 'gif', 'bmp', 'svg', 'avif'],
    'gif': ['png', 'jpg', 'jpeg', 'webp', 'mp4', 'webm'],
    'bmp': ['png', 'jpg', 'jpeg', 'webp', 'gif'],
    'svg': ['png', 'jpg', 'jpeg', 'pdf'],
    'ico': ['png', 'jpg', 'jpeg'],
    'tiff': ['png', 'jpg', 'jpeg', 'webp'],
    'avif': ['png', 'jpg', 'jpeg', 'webp'],
    
    // Videos
    'mp4': ['webm', 'avi', 'mov', 'mkv', 'flv', 'wmv', 'gif', 'mp3', 'wav', 'ogg', 'aac'],
    'webm': ['mp4', 'avi', 'mov', 'mkv', 'flv', 'wmv', 'gif', 'mp3', 'wav', 'ogg', 'aac'],
    'avi': ['mp4', 'webm', 'mov', 'mkv', 'flv', 'wmv', 'gif', 'mp3', 'wav'],
    'mov': ['mp4', 'webm', 'avi', 'mkv', 'flv', 'wmv', 'gif', 'mp3', 'wav'],
    'mkv': ['mp4', 'webm', 'avi', 'mov', 'flv', 'wmv', 'gif', 'mp3', 'wav', 'ogg', 'aac'],
    'flv': ['mp4', 'webm', 'avi', 'mov', 'mkv', 'wmv', 'gif'],
    'wmv': ['mp4', 'webm', 'avi', 'mov', 'mkv', 'gif'],
    
    // Audio
    'mp3': ['wav', 'ogg', 'aac', 'flac', 'm4a', 'wma'],
    'wav': ['mp3', 'ogg', 'aac', 'flac', 'm4a'],
    'ogg': ['mp3', 'wav', 'aac', 'flac'],
    'aac': ['mp3', 'wav', 'ogg', 'flac'],
    'flac': ['mp3', 'wav', 'ogg', 'aac'],
    'm4a': ['mp3', 'wav', 'ogg', 'aac'],
    'wma': ['mp3', 'wav', 'ogg'],
    
    // Documents
    'pdf': ['docx', 'txt', 'html', 'png', 'jpg'],
    'docx': ['pdf', 'txt', 'html', 'odt', 'rtf'],
    'doc': ['pdf', 'docx', 'txt', 'html', 'rtf'],
    'txt': ['pdf', 'docx', 'html', 'md', 'rtf'],
    'html': ['pdf', 'docx', 'txt', 'md'],
    'md': ['html', 'pdf', 'docx', 'txt'],
    'rtf': ['pdf', 'docx', 'txt', 'html'],
    'odt': ['pdf', 'docx', 'txt', 'html'],
    'xlsx': ['csv', 'xls', 'pdf', 'html'],
    'xls': ['xlsx', 'csv', 'pdf', 'html'],
    'csv': ['xlsx', 'xls', 'json', 'txt'],
    'pptx': ['pdf', 'ppt', 'html'],
    'ppt': ['pdf', 'pptx', 'html'],
    
    // Code/Data
    'json': ['csv', 'xml', 'yaml', 'txt'],
    'xml': ['json', 'csv', 'yaml', 'txt'],
    'yaml': ['json', 'xml', 'txt'],
    'yml': ['json', 'xml', 'txt'],
    
    // Archives
    'zip': ['tar', 'gz', '7z', 'rar'],
    'tar': ['zip', 'gz', '7z'],
    'gz': ['zip', 'tar', '7z'],
    '7z': ['zip', 'tar', 'gz'],
    'rar': ['zip', 'tar', '7z']
  };

  // Elements
  const uploadZone = document.getElementById('upload-zone');
  const fileInput = document.getElementById('file-input');
  const fileInfo = document.getElementById('file-info');
  const formatSelectContainer = document.getElementById('format-select-container');
  const outputFormat = document.getElementById('output-format');
  const convertBtn = document.getElementById('convert-btn');
  const downloadBtn = document.getElementById('download-btn');
  const progressBar = document.getElementById('progress-bar');
  const progressFill = document.getElementById('progress-fill');
  const status = document.getElementById('status');
  const previewSection = document.getElementById('preview-section');
  const previewCanvas = document.getElementById('preview-canvas');
  const editorControls = document.getElementById('editor-controls');
  const gifControls = document.getElementById('gif-controls');
  
  // State
  let selectedFile = null;
  let convertedBlob = null;
  let originalImage = null;
  let currentOutputFormat = null;
  let filters = {
    brightness: 100,
    contrast: 100,
    saturation: 100,
    blur: 0,
    rotation: 0,
    gifColors: 256
  };

  // Upload zone handlers
  uploadZone.addEventListener('click', () => fileInput.click());
  
  uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadZone.classList.add('drag-over');
  });
  
  uploadZone.addEventListener('dragleave', () => {
    uploadZone.classList.remove('drag-over');
  });
  
  uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.classList.remove('drag-over');
    if (e.dataTransfer.files.length > 0) {
      handleFile(e.dataTransfer.files[0]);
    }
  });
  
  fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
      handleFile(e.target.files[0]);
    }
  });

  function handleFile(file) {
    selectedFile = file;
    const ext = file.name.split('.').pop().toLowerCase();
    
    console.log('üìÅ File uploaded:', file.name, 'Extension:', ext);
    
    // Display file info
    document.getElementById('file-name').textContent = file.name;
    document.getElementById('file-type').textContent = ext.toUpperCase();
    document.getElementById('file-size').textContent = formatBytes(file.size);
    fileInfo.style.display = 'block';
    
    // Reset state
    originalImage = null;
    currentOutputFormat = null;
    
    // Load image
    const imageFormats = ['png', 'jpg', 'jpeg', 'webp', 'bmp', 'gif', 'ico', 'tiff', 'avif'];
    if (imageFormats.includes(ext)) {
      console.log('üñºÔ∏è Loading image...');
      const reader = new FileReader();
      reader.onload = (e) => {
        console.log('üì• File read complete, creating Image object...');
        const img = new Image();
        img.onload = () => {
          originalImage = img;
          console.log('‚úÖ Image loaded successfully:', img.width, 'x', img.height);
          if (ext === 'gif') {
            console.log('‚ÑπÔ∏è NOTE: GIFs only show first frame in canvas (HTML5 spec limitation)');
          }
          
          // If format already selected, show preview immediately
          if (currentOutputFormat) {
            console.log('Format already selected, showing preview now');
            showPreview();
          }
        };
        img.onerror = (err) => {
          console.error('‚ùå Failed to load image:', err);
          showStatus('error', 'Failed to load image. File may be corrupted or unsupported.');
        };
        img.src = e.target.result;
        console.log('üîÑ Image src set, waiting for onload...');
      };
      reader.onerror = (err) => {
        console.error('‚ùå FileReader error:', err);
        showStatus('error', 'Failed to read file.');
      };
      reader.readAsDataURL(file);
      console.log('üîÑ FileReader started...');
    } else {
      console.log('‚ö†Ô∏è Not an image format');
    }
    
    // Populate formats
    const formats = formatMap[ext] || [];
    console.log('üîÑ Available formats for', ext, ':', formats);
    
    outputFormat.innerHTML = '<option value="">Select format...</option>';
    
    if (formats.length > 0) {
      formats.forEach(format => {
        const option = document.createElement('option');
        option.value = format;
        option.textContent = format.toUpperCase();
        outputFormat.appendChild(option);
      });
      formatSelectContainer.style.display = 'flex';
      convertBtn.disabled = true;
      convertBtn.textContent = 'Select an output format';
      console.log('‚úÖ Format dropdown populated');
    } else {
      formatSelectContainer.style.display = 'none';
      showStatus('error', `No conversions available for .${ext} files`);
      console.error('‚ùå No formats available for', ext);
    }
    
    // Hide preview until format selected
    previewSection.style.display = 'none';
    editorControls.classList.remove('active');
    downloadBtn.style.display = 'none';
  }

  // Output format selection
  outputFormat.addEventListener('change', () => {
    console.log('üéØ Format dropdown changed to:', outputFormat.value);
    
    if (!outputFormat.value) {
      previewSection.style.display = 'none';
      editorControls.classList.remove('active');
      convertBtn.disabled = true;
      convertBtn.textContent = 'Select an output format';
      return;
    }
    
    currentOutputFormat = outputFormat.value;
    convertBtn.disabled = false;
    convertBtn.textContent = `Convert to ${currentOutputFormat.toUpperCase()}`;
    
    console.log('Selected format:', currentOutputFormat);
    console.log('Original image exists?', !!originalImage);
    console.log('File type:', selectedFile.name.split('.').pop().toLowerCase());
    
    const ext = selectedFile.name.split('.').pop().toLowerCase();
    const imageFormats = ['png', 'jpg', 'jpeg', 'webp', 'bmp', 'gif', 'ico', 'tiff', 'avif'];
    const videoFormats = ['mp4', 'webm', 'avi', 'mov', 'mkv', 'flv', 'wmv'];
    
    // Check if it's an image format
    if (imageFormats.includes(ext)) {
      // Show preview if image loaded
      if (originalImage) {
        console.log('Image ready, showing preview immediately');
        showPreview();
      } else {
        console.log('‚è≥ Waiting for image to load...');
        // Retry multiple times
        let attempts = 0;
        const checkInterval = setInterval(() => {
          attempts++;
          console.log(`Attempt ${attempts}/10 - Image loaded?`, !!originalImage);
          
          if (originalImage) {
            console.log('‚úÖ Image finally loaded, showing preview');
            clearInterval(checkInterval);
            showPreview();
          } else if (attempts >= 10) {
            console.error('‚ùå Gave up waiting for image after 10 attempts');
            clearInterval(checkInterval);
            showStatus('error', 'Failed to load image. Try uploading again.');
          }
        }, 200);
      }
    } else if (videoFormats.includes(ext)) {
      console.log('üìπ Video file detected - no preview/editing available yet');
      showStatus('info', 'Video conversion will happen without preview. Click Convert when ready.');
    } else {
      console.log('üìÑ Non-image/video file - no preview available');
      showStatus('info', 'File conversion will happen without preview. Click Convert when ready.');
    }
  });

  function showPreview() {
    console.log('========================================');
    console.log('üì∑ showPreview() called');
    console.log('Current output format:', currentOutputFormat);
    console.log('Original image:', originalImage);
    console.log('========================================');
    
    if (!originalImage) {
      console.error('‚ùå ERROR: No original image in showPreview');
      return;
    }
    
    if (!currentOutputFormat) {
      console.error('‚ùå ERROR: No output format in showPreview');
      return;
    }
    
    console.log('‚úÖ Showing preview section');
    previewSection.style.display = 'block';
    editorControls.classList.add('active');
    
    // Show GIF controls if converting to GIF
    if (currentOutputFormat === 'gif') {
      console.log('üé® Showing GIF color controls');
      gifControls.style.display = 'block';
    } else {
      console.log('üì∏ Hiding GIF controls (not converting to GIF)');
      gifControls.style.display = 'none';
    }
    
    console.log('üé® Calling renderPreview...');
    renderPreview();
  }

  function renderPreview() {
    console.log('üé® renderPreview() called');
    
    if (!originalImage) {
      console.error('‚ùå No image to render');
      return;
    }
    
    console.log('Drawing to canvas...');
    const canvas = previewCanvas;
    const ctx = canvas.getContext('2d');
    
    const angle = (filters.rotation * Math.PI) / 180;
    const w = originalImage.width;
    const h = originalImage.height;
    
    console.log('Image dimensions:', w, 'x', h);
    console.log('Rotation angle:', filters.rotation, 'degrees');
    
    // Handle rotation
    const sin = Math.abs(Math.sin(angle));
    const cos = Math.abs(Math.cos(angle));
    canvas.width = w * cos + h * sin;
    canvas.height = w * sin + h * cos;
    
    console.log('Canvas dimensions:', canvas.width, 'x', canvas.height);
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Apply CSS filters
    const filterString = `brightness(${filters.brightness}%) contrast(${filters.contrast}%) saturate(${filters.saturation}%) blur(${filters.blur}px)`;
    console.log('Applying filters:', filterString);
    ctx.filter = filterString;
    
    // Draw with rotation
    ctx.save();
    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.rotate(angle);
    ctx.drawImage(originalImage, -w / 2, -h / 2, w, h);
    ctx.restore();
    
    console.log('‚úÖ Image drawn to canvas');
    
    // Apply GIF color reduction
    if (currentOutputFormat === 'gif') {
      console.log('üé® Applying GIF color reduction with', filters.gifColors, 'colors');
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      const colorStep = 256 / Math.cbrt(filters.gifColors);
      
      console.log('Color step:', colorStep);
      
      for (let i = 0; i < data.length; i += 4) {
        data[i] = Math.round(data[i] / colorStep) * colorStep;
        data[i + 1] = Math.round(data[i + 1] / colorStep) * colorStep;
        data[i + 2] = Math.round(data[i + 2] / colorStep) * colorStep;
      }
      
      ctx.putImageData(imageData, 0, 0);
      console.log('‚úÖ GIF color reduction applied');
    }
    
    console.log('‚úÖ‚úÖ‚úÖ Preview render complete!');
  }

  // Filter controls
  document.getElementById('brightness').addEventListener('input', (e) => {
    filters.brightness = e.target.value;
    document.getElementById('brightness-val').textContent = e.target.value + '%';
    renderPreview();
  });

  document.getElementById('contrast').addEventListener('input', (e) => {
    filters.contrast = e.target.value;
    document.getElementById('contrast-val').textContent = e.target.value + '%';
    renderPreview();
  });

  document.getElementById('saturation').addEventListener('input', (e) => {
    filters.saturation = e.target.value;
    document.getElementById('saturation-val').textContent = e.target.value + '%';
    renderPreview();
  });

  document.getElementById('blur').addEventListener('input', (e) => {
    filters.blur = e.target.value;
    document.getElementById('blur-val').textContent = e.target.value + 'px';
    renderPreview();
  });

  document.getElementById('rotation').addEventListener('input', (e) => {
    filters.rotation = e.target.value;
    document.getElementById('rotation-val').textContent = e.target.value + '¬∞';
    renderPreview();
  });

  document.getElementById('gif-colors').addEventListener('input', (e) => {
    filters.gifColors = e.target.value;
    document.getElementById('gif-colors-val').textContent = e.target.value;
    renderPreview();
  });

  document.getElementById('reset-filters').addEventListener('click', () => {
    filters = { brightness: 100, contrast: 100, saturation: 100, blur: 0, rotation: 0, gifColors: 256 };
    document.getElementById('brightness').value = 100;
    document.getElementById('contrast').value = 100;
    document.getElementById('saturation').value = 100;
    document.getElementById('blur').value = 0;
    document.getElementById('rotation').value = 0;
    document.getElementById('gif-colors').value = 256;
    document.getElementById('brightness-val').textContent = '100%';
    document.getElementById('contrast-val').textContent = '100%';
    document.getElementById('saturation-val').textContent = '100%';
    document.getElementById('blur-val').textContent = '0px';
    document.getElementById('rotation-val').textContent = '0¬∞';
    document.getElementById('gif-colors-val').textContent = '256';
    renderPreview();
  });

  // Convert button
  convertBtn.addEventListener('click', async () => {
    if (!selectedFile || !currentOutputFormat) return;
    
    convertBtn.disabled = true;
    convertBtn.textContent = 'Converting...';
    progressBar.style.display = 'block';
    downloadBtn.style.display = 'none';
    
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 30;
      if (progress > 90) progress = 90;
      progressFill.style.width = progress + '%';
    }, 200);
    
    try {
      const imageFormats = ['png', 'jpg', 'jpeg', 'webp', 'gif', 'bmp', 'ico', 'tiff', 'avif'];
      
      if (imageFormats.includes(selectedFile.name.split('.').pop().toLowerCase()) && 
          imageFormats.includes(currentOutputFormat)) {
        // Use the edited canvas
        convertedBlob = await new Promise((resolve) => {
          previewCanvas.toBlob(resolve, getMimeType(currentOutputFormat), 0.95);
        });
      } else {
        // Fallback
        await new Promise(resolve => setTimeout(resolve, 2000));
        convertedBlob = new Blob([selectedFile], { type: getMimeType(currentOutputFormat) });
      }
      
      clearInterval(interval);
      progressFill.style.width = '100%';
      
      setTimeout(() => {
        progressBar.style.display = 'none';
        progressFill.style.width = '0%';
        showStatus('success', `‚úÖ Converted to ${currentOutputFormat.toUpperCase()}!`);
        convertBtn.textContent = 'Convert Another';
        convertBtn.disabled = false;
        downloadBtn.style.display = 'block';
      }, 500);
      
    } catch (error) {
      clearInterval(interval);
      progressBar.style.display = 'none';
      showStatus('error', `‚ùå Conversion failed: ${error.message}`);
      convertBtn.textContent = 'Try Again';
      convertBtn.disabled = false;
    }
  });

  downloadBtn.addEventListener('click', () => {
    if (!convertedBlob) return;
    
    const baseName = selectedFile.name.replace(/\.[^/.]+$/, '');
    const link = document.createElement('a');
    link.href = URL.createObjectURL(convertedBlob);
    link.download = `${baseName}.${currentOutputFormat}`;
    link.click();
    
    showStatus('success', 'üì• Download started!');
  });

  function getMimeType(ext) {
    const types = {
      'png': 'image/png', 'jpg': 'image/jpeg', 'jpeg': 'image/jpeg',
      'webp': 'image/webp', 'gif': 'image/gif', 'bmp': 'image/bmp',
      'svg': 'image/svg+xml', 'mp4': 'video/mp4', 'webm': 'video/webm',
      'mp3': 'audio/mpeg', 'wav': 'audio/wav', 'pdf': 'application/pdf',
      'txt': 'text/plain', 'html': 'text/html', 'json': 'application/json'
    };
    return types[ext] || 'application/octet-stream';
  }

  function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
  }

  function showStatus(type, message) {
    status.className = `status ${type}`;
    status.textContent = message;
    status.style.display = 'block';
    setTimeout(() => status.style.display = 'none', 5000);
  }
</script>

</body>
</html>
