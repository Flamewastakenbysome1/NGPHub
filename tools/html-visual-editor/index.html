<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Mini HTML UI Builder (Offline)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0f1115;--panel:#151923;--ink:#e7ecf3;--mut:#9aa4b2;--acc:#4da3ff;--line:#232838}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.3 system-ui,Segoe UI,Roboto,Arial}
  .app{display:grid;grid-template-rows:auto 1fr auto;height:100%}
  .top{display:flex;gap:8px;align-items:center;padding:10px;border-bottom:1px solid var(--line);background:var(--panel);position:sticky;top:0;z-index:5}
  .group{display:flex;gap:6px;flex-wrap:wrap;background:#0f1320;border:1px solid var(--line);border-radius:10px;padding:6px}
  button,label.btn{background:#1b2130;color:var(--ink);border:1px solid var(--line);padding:8px 10px;border-radius:8px;cursor:pointer}
  button:hover,label.btn:hover{outline:1px solid var(--acc)}
  button:active{transform:translateY(1px)}
  .split{display:grid;grid-template-columns:320px 1fr;min-height:0}
  .side{border-right:1px solid var(--line);background:#0f1320;min-width:0}
  .side h3{margin:14px 12px 6px;color:var(--mut);font-weight:600}
  textarea,input[type="text"]{width:100%;background:#0c101b;color:var(--ink);border:1px solid var(--line);border-radius:8px;padding:10px;resize:vertical}
  textarea{min-height:120px}
  .side .box{padding:10px}
  iframe#canvas{width:100%;height:100%;border:0;background:#fff}
  .status{padding:8px 12px;border-top:1px solid var(--line);color:var(--mut);background:var(--panel);display:flex;justify-content:space-between;gap:8px}
  .kbd{border:1px solid var(--line);padding:2px 6px;border-radius:6px;background:#0f1320;color:var(--mut)}
  .pill{padding:3px 8px;background:#10243a;border:1px solid var(--line);border-radius:999px}
  .blockbtns button{width:100%;text-align:left}
  .filehide{display:none}
</style>
</head>
<body>
<div class="app">
  <div class="top">
    <div class="group">
      <label class="btn" title="Open .html file">
        Open HTML <input id="openFile" class="filehide" type="file" accept=".html,.htm,.xhtml,.txt" />
      </label>
      <button onclick="applyPasted()" title="Load from the Paste box on the left">Load Pasted</button>
      <button id="toggleEdit" onclick="toggleEdit()" title="Enable/Disable visual editing (text/content)">Enable Edit</button>
      <button onclick="injectBaseCSS()" title="Adds simple utility CSS into the page">Add Base CSS</button>
      <button onclick="downloadHTML()" title="Download the edited HTML">Export HTML</button>
    </div>
    <div class="group">
      <button onclick="cmd('bold')" title="Bold (Ctrl+B)"><b>B</b></button>
      <button onclick="cmd('italic')" title="Italic (Ctrl+I)"><i>I</i></button>
      <button onclick="cmd('underline')" title="Underline (Ctrl+U)"><u>U</u></button>
      <button onclick="cmd('formatBlock','H1')" title="Heading 1">H1</button>
      <button onclick="cmd('formatBlock','H2')" title="Heading 2">H2</button>
      <button onclick="cmd('insertUnorderedList')" title="Bullet list">• List</button>
      <button onclick="cmd('insertOrderedList')" title="Numbered list">1. List</button>
      <button onclick="makeLink()" title="Insert/Edit link">Link</button>
      <button onclick="insertImage()" title="Insert image by URL">Image</button>
      <button onclick="cmd('removeFormat')" title="Clear formatting">Clear</button>
    </div>
    <div class="group">
      <span class="pill">Tip: double-click text to edit.</span>
    </div>
  </div>

  <div class="split">
    <div class="side">
      <h3>Paste HTML</h3>
      <div class="box">
        <textarea id="pasteHtml" placeholder="Paste your HTML here..."></textarea>
        <div style="height:8px"></div>
        <button onclick="applyPasted()">Load Pasted →</button>
      </div>
      <h3>Insert Blocks</h3>
      <div class="box blockbtns">
        <button onclick="insertBlock(sampleBlocks.hero)">Hero section</button>
        <button onclick="insertBlock(sampleBlocks.cardGrid)">3-Card grid</button>
        <button onclick="insertBlock(sampleBlocks.cta)">CTA section</button>
        <button onclick="insertBlock(sampleBlocks.nav)">Simple navbar</button>
        <button onclick="insertBlock(sampleBlocks.footer)">Footer</button>
        <div style="height:8px"></div>
        <button onclick="wrapSelection('<div class=&quot;container&quot;>','</div>')">Wrap in .container</button>
        <button onclick="wrapSelection('<section class=&quot;section&quot;>','</section>')">Wrap in &lt;section&gt;</button>
      </div>
      <h3>Extra CSS (optional)</h3>
      <div class="box">
        <textarea id="extraCss" placeholder="/* CSS added to <head> */"></textarea>
        <div style="height:8px"></div>
        <button onclick="injectExtraCSS()">Inject CSS</button>
      </div>
    </div>

    <iframe id="canvas" title="Design Canvas"></iframe>
  </div>

  <div class="status">
    <div>Mode: <span id="mode" class="kbd">View</span></div>
    <div><span class="kbd">Ctrl+S</span> export · <span class="kbd">Ctrl+E</span> toggle edit</div>
  </div>
</div>

<script>
  const frame = document.getElementById('canvas');
  const openFile = document.getElementById('openFile');
  const modeEl = document.getElementById('mode');
  const toggleBtn = document.getElementById('toggleEdit');

  // --- Boot with blank document
  const BLANK_DOC = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untitled</title></head><body style="font-family:system-ui,Segoe UI,Roboto,Arial; margin:0"><main class="container section"><h1>Start editing</h1><p>Select text and use the toolbar. Insert blocks from the left. Export when done.</p></main></body></html>`;
  frame.srcdoc = BLANK_DOC;

  // Handle file open
  openFile.addEventListener('change', async (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    const text = await f.text();
    loadHtml(text);
    openFile.value = "";
  });

  function getDoc(){ return frame.contentDocument || frame.contentWindow.document; }

  function loadHtml(html){
    // Ensure it’s a full HTML doc
    const hasHtmlTag = /<\s*html[\s>]/i.test(html);
    frame.srcdoc = hasHtmlTag ? html : `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Imported</title></head><body>${html}</body></html>`;
    frame.onload = () => {
      // prevent accidental nav when editing
      getDoc().body.addEventListener('click', ev=>{
        if(getDoc().body.isContentEditable && ev.target.closest('a')){
          ev.preventDefault();
        }
      }, true);
    };
    setEdit(false);
  }

  function applyPasted(){
    const txt = document.getElementById('pasteHtml').value;
    if(!txt.trim()) return;
    loadHtml(txt);
  }

  function setEdit(on){
    const doc = getDoc();
    doc.body.contentEditable = on ? "true" : "false";
    modeEl.textContent = on ? "Edit" : "View";
    toggleBtn.textContent = on ? "Disable Edit" : "Enable Edit";
  }

  function toggleEdit(){ setEdit(!(getDoc().body.isContentEditable)); }

  // execCommand helper (still widely supported for simple WYSIWYG)
  function cmd(c,v=null){ getDoc().execCommand(c,false,v); frame.contentWindow.focus(); }

  function makeLink(){
    const url = prompt("Link URL:");
    if(!url) return;
    cmd('createLink', url);
  }

  function insertImage(){
    const url = prompt("Image URL (https://...)");
    if(!url) return;
    cmd('insertImage', url);
  }

  function insertBlock(html){
    getDoc().execCommand('insertHTML', false, html);
  }

  function wrapSelection(prefix,suffix){
    getDoc().execCommand('insertHTML', false, prefix + getSelectionHtml() + suffix);
  }

  function getSelectionHtml(){
    const doc = getDoc();
    const sel = doc.getSelection();
    if(!sel || sel.rangeCount===0) return "";
    const div = doc.createElement('div');
    for(let i=0;i<sel.rangeCount;i++){ div.appendChild(sel.getRangeAt(i).cloneContents()); }
    return div.innerHTML;
  }

  // Add a small utility CSS set into the page (safe, scoped to content)
  function injectBaseCSS(){
    const doc = getDoc();
    if(doc.getElementById('mini-editor-styles')) return;
    const css = `
/* === Mini Builder Base === */
:root{--ink:#111;--mut:#475569;--bg:#ffffff;--pri:#2563eb;--soft:#f1f5f9}
*{box-sizing:border-box}
body{color:var(--ink)}
.container{max-width:980px;margin:0 auto;padding:24px}
.section{padding:48px 0}
.hero{padding:80px 0;background:linear-gradient(180deg,#eef6ff,#ffffff)}
.hero h1{font-size:42px;margin:0 0 10px}
.hero p{font-size:18px;color:var(--mut);margin:0 0 20px}
.btn{display:inline-block;padding:12px 18px;border-radius:8px;border:1px solid #cbd5e1;background:#fff;color:#111;text-decoration:none}
.btn.primary{background:var(--pri);color:#fff;border-color:var(--pri)}
.grid{display:grid;gap:16px}
.grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
.card{border:1px solid #e2e8f0;border-radius:12px;background:#fff;padding:18px}
.nav{display:flex;gap:16px;align-items:center;padding:12px 0;border-bottom:1px solid #e2e8f0}
.nav a{text-decoration:none;color:#111}
.footer{padding:30px 0;border-top:1px solid #e2e8f0;color:#475569}
.center{text-align:center}
    `.trim();
    const style = doc.createElement('style');
    style.id = 'mini-editor-styles';
    style.textContent = css;
    doc.head.appendChild(style);
  }

  function injectExtraCSS(){
    const css = document.getElementById('extraCss').value;
    if(!css.trim()) return;
    const doc = getDoc();
    const style = doc.createElement('style');
    style.textContent = css;
    doc.head.appendChild(style);
  }

  // Export current iframe HTML
  function downloadHTML(){
    const doc = getDoc();
    // Ensure <meta charset> exists
    if(!doc.querySelector('meta[charset]')){
      const meta = doc.createElement('meta'); meta.setAttribute('charset','utf-8');
      doc.head.prepend(meta);
    }
    const html = "<!doctype html>\n" + doc.documentElement.outerHTML;
    const blob = new Blob([html], {type:'text/html'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = (doc.title?.trim() || 'page') + '.html';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(a.href);
  }

  // Keyboard shortcuts
  addEventListener('keydown', e=>{
    const mod = e.ctrlKey || e.metaKey;
    if(mod && e.key.toLowerCase()==='s'){ e.preventDefault(); downloadHTML(); }
    if(mod && e.key.toLowerCase()==='e'){ e.preventDefault(); toggleEdit(); }
  });

  // Sample blocks
  const sampleBlocks = {
    hero: `
<section class="hero">
  <div class="container center">
    <h1>Your Cool Headline</h1>
    <p>Short subtext describing the thing. Edit me.</p>
    <a class="btn primary" href="#">Get Started</a>
    <a class="btn" href="#">Learn More</a>
  </div>
</section>
`.trim(),
    cardGrid: `
<section class="section">
  <div class="container">
    <h2 class="center">Features</h2>
    <div class="grid grid-3">
      <div class="card"><h3>One</h3><p>Edit this text.</p></div>
      <div class="card"><h3>Two</h3><p>Edit this text.</p></div>
      <div class="card"><h3>Three</h3><p>Edit this text.</p></div>
    </div>
  </div>
</section>
`.trim(),
    cta: `
<section class="section center" style="background:var(--soft)">
  <div class="container">
    <h2>Call To Action</h2>
    <p>Say something inspiring here.</p>
    <a class="btn primary" href="#">Do the thing</a>
  </div>
</section>
`.trim(),
    nav: `
<div class="container nav">
  <strong>MySite</strong>
  <a href="#">Home</a><a href="#">About</a><a href="#">Contact</a>
</div>
`.trim(),
    footer: `
<footer class="footer">
  <div class="container">&copy; <span id="y">${new Date().getFullYear()}</span> Your Name</div>
</footer>
`.trim()
  };
</script>
</body>
</html>
